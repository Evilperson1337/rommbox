<UserControl x:Class="RomMbox.UI.Views.SettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             Width="800">

    <UserControl.Resources>
        <Style x:Key="DarkSecondaryButton" TargetType="Button">
            <Setter Property="Background" Value="#1C2230"/>
            <Setter Property="Foreground" Value="#E6EBF5"/>
            <Setter Property="BorderBrush" Value="#2D374B"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="BorderBrush" Value="#4A6EDC"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="#283042"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Bd" Property="Opacity" Value="0.6"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DarkTextBox" TargetType="TextBox">
            <Setter Property="Background" Value="#1C2230"/>
            <Setter Property="Foreground" Value="#E6EBF5"/>
            <Setter Property="BorderBrush" Value="#2D374B"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="10,6"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>

        <Style x:Key="CellCheckBoxStyle" TargetType="CheckBox">
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Foreground" Value="#E6EBF5"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="CheckBox">
                        <Grid Width="16" Height="16">
                            <Border x:Name="Box"
                                    Background="Transparent"
                                    BorderBrush="#5B6575"
                                    BorderThickness="1"
                                    CornerRadius="2"/>
                            <Path x:Name="CheckMark"
                                  Data="M 3 8 L 7 12 L 13 4"
                                  Stroke="#E6EBF5"
                                  StrokeThickness="2"
                                  StrokeStartLineCap="Square"
                                  StrokeEndLineCap="Square"
                                  Visibility="Collapsed"/>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="CheckMark" Property="Visibility" Value="Visible"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Box" Property="Opacity" Value="0.5"/>
                                <Setter TargetName="CheckMark" Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <StackPanel>
        <TextBlock Text="Settings" Style="{StaticResource PageHeader}" Foreground="#FF7F7F7F" FontWeight="Bold"/>
        <TextBlock Text="Configure download and extraction behavior per platform."
                   Style="{StaticResource HelperText}"
                   Margin="0,0,0,14"/>

        <DockPanel Margin="0,0,0,12">
            <Button Content="Refresh"
                    DockPanel.Dock="Right"
                    Width="110"
                    Command="{Binding RefreshCommand}"
                    Style="{StaticResource DarkSecondaryButton}"/>
        </DockPanel>

        <Grid Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="140"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0"
                       Text="7-Zip Path"
                       Style="{StaticResource HelperText}"
                       Margin="0,0,14,0"
                       VerticalAlignment="Center"/>

            <TextBox Grid.Column="1"
                     Style="{StaticResource DarkTextBox}"
                     Text="{Binding SevenZipPath, UpdateSourceTrigger=PropertyChanged}"/>

            <Button Grid.Column="2"
                    Content="Browse"
                    Width="110"
                    Margin="12,0,0,0"
                    Command="{Binding BrowseSevenZipCommand}"
                    Style="{StaticResource DarkSecondaryButton}"/>
        </Grid>

        <StackPanel Margin="0,0,0,12">
            <CheckBox Content="Use 7-Zip fallback when managed extraction fails"
                      IsChecked="{Binding UseSevenZipFallback, Mode=TwoWay}"
                      Foreground="#E6EBF5"/>
            <CheckBox Content="Keep archives after extraction"
                      Margin="0,6,0,0"
                      IsChecked="{Binding KeepArchivesAfterExtraction, Mode=TwoWay}"
                      Foreground="#E6EBF5"/>
        </StackPanel>

        <TextBlock Text="{Binding StatusText}" Style="{StaticResource HelperText}" Margin="0,0,0,10"/>

        <DataGrid ItemsSource="{Binding PlatformRows}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  HeadersVisibility="Column"
                  Height="420"
                  Background="#141822"
                  BorderBrush="{StaticResource BorderBrush}"
                  BorderThickness="1"
                  RowBackground="#141822"
                  AlternatingRowBackground="#151A26"
                  GridLinesVisibility="Horizontal"
                  HorizontalGridLinesBrush="#283042"
                  VerticalGridLinesBrush="#283042"
                  ScrollViewer.VerticalScrollBarVisibility="Visible"
                  ScrollViewer.HorizontalScrollBarVisibility="Disabled">

            <DataGrid.ColumnHeaderStyle>
                <Style TargetType="DataGridColumnHeader">
                    <Setter Property="Background" Value="#1C2230"/>
                    <Setter Property="Foreground" Value="#AAB4C8"/>
                    <Setter Property="FontWeight" Value="SemiBold"/>
                    <Setter Property="Padding" Value="10,8"/>
                    <Setter Property="BorderBrush" Value="#2D374B"/>
                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                </Style>
            </DataGrid.ColumnHeaderStyle>

            <DataGrid.Resources>
                <Style TargetType="DataGridCell">
                    <Setter Property="BorderThickness" Value="0"/>
                    <Setter Property="BorderBrush" Value="Transparent"/>
                    <Setter Property="Foreground" Value="#E6EBF5"/>
                    <Style.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background" Value="#141822"/>
                            <Setter Property="BorderBrush" Value="Transparent"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </DataGrid.Resources>

            <DataGrid.Columns>
                <DataGridTextColumn Header="RomM Platform" Binding="{Binding RommPlatformName}" Width="2*" IsReadOnly="True"/>
                <DataGridTextColumn Header="LaunchBox Platform" Binding="{Binding LaunchBoxPlatformName}" Width="2*" IsReadOnly="True"/>
                <DataGridTemplateColumn Header="Extract After Download" Width="170">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <CheckBox Style="{StaticResource CellCheckBoxStyle}"
                                      IsChecked="{Binding ExtractAfterDownload, Mode=TwoWay}"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridComboBoxColumn Header="Extraction Behavior"
                                        Width="160"
                                        SelectedItemBinding="{Binding ExtractionBehavior, Mode=TwoWay}"
                                        ItemsSource="{Binding DataContext.BehaviorOptions, RelativeSource={RelativeSource AncestorType=DataGrid}}"/>
            </DataGrid.Columns>
        </DataGrid>

        <StackPanel Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,12,0,0">
            <Button Content="Save"
                    Command="{Binding SaveCommand}"
                    Width="110"
                    Style="{StaticResource PrimaryButton}"/>
        </StackPanel>
    </StackPanel>
</UserControl>
